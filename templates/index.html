{% extends "layout.html" %}
{% block title %}Dashboard | AI Crime Predictor{% endblock %}

{% block content %}
<div class="dashboard-box mx-auto  p-4 " style="max-width: 550px; background: #ffffffcc; backdrop-filter: blur(10px);">
    <h2 class="text-center text-dark fw-normal ">AI Crime Prediction System</h2>
    <div id="status" class="mt-3 p-3  text-success fw-bolder ">

    </div>

    <!-- File Upload Form -->
    <form id="uploadForm" enctype="multipart/form-data" class="my-3">
        <label for="file" class="file-label d-block text-center p-3 border border-2 border-dashed rounded bg-light"
            style="cursor:pointer;">
            <i class='bx bx-upload'></i><br>Choose CSV File
        </label>
        <input type="file" name="file" id="file" required hidden>
    </form>
    <div class="mt-3 p-3  "></div>

    <!-- Buttons -->
    <div class="row g-3">
        <div class="col-md-6">
            <button class="btn btn-success text-capitalize text-start py-2   w-100" type="submit" form="uploadForm">
                <i class='bx bx-upload   p-2  text-white rounded-3 ' style="background: #22b16f ;"></i>
                <span class="h6 ps-1">Upload CSV</span>
            </button>
        </div>
        <div class="col-md-6">
            <button id="trainBtn" class="btn btn-success text-capitalize py-2 text-start   w-100">
                <i class='bx bx-cube-alt p-2  text-white rounded-3 ' style="background: #22b16f ;"> </i>
                <span class="h6 ps-1"> Train Model</span>
            </button>
        </div>
        <div class="col-md-6"><a href="/forecast" class="btn btn-success text-capitalize py-2 text-start   w-100">
                <i class='bx bx-line-chart p-2  text-white rounded-3 ' style="background: #22b16f ;"> </i>
                <span class="h6 ps-1"> View Forecast</span>
            </a>
        </div>
        <div class="col-md-6"><a href="/table" class="btn btn-success text-capitalize py-2 text-start   w-100">
                <i class='bx bx-table p-2  text-white rounded-3 ' style="background: #22b16f ;"> </i>
                <span class="h6 ps-1 ">View Table & Insights</span>
            </a>
        </div>
        <div class="col-md-6"><a href="/download-model" class="btn btn-success text-capitalize py-2 text-start   w-100">
                <i class='bx bx-download p-2  text-white rounded-3 ' style="background: #22b16f ;"> </i>
                <span class="h6 ps-1"> Download Model</span>
            </a>
        </div>
        <div class="col-md-6"><a href="{{ url_for('download_demo_csv') }}"
                class="btn btn-success text-capitalize py-2 text-start   w-100">
                <i class='bx bx-download p-2  text-white rounded-3 ' style="background: #22b16f ;"> </i>
                <span class="h6 ps-1"> Download Demo CSV</span>
            </a>
        </div>
    </div>

</div>
{% endblock %}

{% block extra_js %}
<script>
    function showMessage(data) {
        if (data.message) {
            document.getElementById("status").innerText = data.message.replace(/^[^a-zA-Z0-9]+/, "");
        }
    }

    document.getElementById("uploadForm").addEventListener("submit", async function (e) {
        e.preventDefault();
        let formData = new FormData(this);
        let res = await fetch("/upload", { method: "POST", body: formData });
        let data = await res.json();
        showMessage(data);
    });

    document.getElementById("trainBtn").addEventListener("click", async function () {
        let res = await fetch("/train", { method: "POST" });
        let data = await res.json();
        showMessage(data);
    });
</script>
{% endblock %}